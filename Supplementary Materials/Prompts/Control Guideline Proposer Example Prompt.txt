GENERAL INSTRUCTIONS
-----------------
In our system, the behavior of a conversational AI agent is guided by "guidelines". The agent makes use of these guidelines whenever it interacts with a user (also referred to as the customer).
Each guideline is composed of two parts:
- "condition": This is a natural-language condition that specifies when a guideline should apply.
          We look at each conversation at any particular state, and we test against this
          condition to understand if we should have this guideline participate in generating
          the next reply to the user.
- "action": This is a natural-language instruction that should be followed by the agent
          whenever the "condition" part of the guideline applies to the conversation in its particular state.
          Any instruction described here applies only to the agent, and not to the user.


Task Description
----------------
Your task is to evaluate the relevance and applicability of a set of provided 'when' conditions to the most recent state of an interaction between yourself (an AI agent) and a user.
These conditions, along with the interaction details, will be provided later in this message.
For each condition that is met, determine whether its corresponding action should be taken by the agent or if it has already been addressed previously.


Process Description
-------------------
a. Examine Interaction Events: Review the provided interaction events to discern the most recent state of the interaction between the user and the agent.
b. Evaluate Condition/s: Assess the entire interaction to determine whether each condition is still relevant and directly fulfilled based on the most recent interaction state.
c. Check for Prior Action: Determine whether the condition has already been addressed, i.e., whether it applied in an earlier state and its corresponding action has already been performed.
d. Guideline Application: A guideline should be applied only if:
    (1) Its condition is currently met and its action has not been performed yet, or
    (2) The interaction warrants re-application of its action (e.g., when a recurring condition becomes true again after previously being fulfilled).

Insights Regarding Guideline re-activation
-------------------
A condition typically no longer applies if its corresponding action has already been executed.
However, there are exceptions where re-application is warranted, such as when the condition is re-applied again. For example, a guideline with the condition "the customer is asking a question" should be applied again whenever the customer asks a question.
Additionally, actions that involve continuous behavior (e.g., "do not ask the user for their age", or guidelines involving the language the agent should use) should be re-applied whenever their condition is met, even if their action was already taken.
If a guideline's condition has multiple requirements, consider it continuous if at least one of them is continuous. Actions like "tell the customer they are pretty and help them with their order" should be considered continuous, since 'helping them with their order' is continuous.
Actions that forbid certain behaviors are generally considered continuous, as they must be upheld across multiple messages to ensure consistent adherence.

IMPORTANT: guidelines that only require you to say a specific thing are generally not continuous. Once you said the required thing - the guideline is fulfilled.

Conversely, actions dictating one-time behavior (e.g., "send the user our address") should be re-applied more conservatively.
Only re-apply these if the condition ceased to be true earlier in the conversation before being fulfilled again in the current context.

IMPORTANT: Some guidelines include multiple actions. If only a portion of those actions were fulfilled earlier in the conversation, treat the guideline as though it has been fully executed.
In such cases, re-apply the guideline only if its condition becomes true again later in the conversation, unless it is continuous.

Examples of Condition Evaluations:
-------------------

Example #1: ###

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Can I purchase a subscription to your software?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Absolutely, I can assist you with that right now."
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Cool, let's go with the subscription for the Pro plan."
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Your subscription has been successfully activated. Is there anything else I can help you with?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Will my son be able to see that I'm subscribed? Or is my data protected?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "If your son is not a member of your same household account, he won't be able to see your subscription. Please refer to our privacy policy page for additional up-to-date information."
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Gotcha, and I imagine that if he does try to add me to the household account he won't be able to see that there already is an account, right?"
    }
  }
]


- **Guidelines**:
1) condition: the customer initiates a purchase., action: Open a new cart for the customer
2) condition: the customer asks about data security, action: Refer the customer to our privacy policy page
3) condition: the customer asked to subscribe to our pro plan, action: maintain a helpful tone and thank them for shopping at our store


- **Expected Result**:

```json
[
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 3
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 9
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 6
  }
]
```

###

Example #2: ###

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'm looking for a job, what do you have available?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Hi there! we have plenty of opportunities for you, where are you located?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "I'm looking for anything around the bay area"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "That's great. We have a number of positions available over there. What kind of role are you interested in?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Anything to do with training and maintaining AI agents"
    }
  }
]


- **Guidelines**:
1) condition: the customer indicates that they are looking for a job., action: ask the customer for their location
2) condition: the customer asks about job openings., action: emphasize that we have plenty of positions relevant to the customer, and over 10,000 opennings overall
3) condition: discussing job opportunities., action: maintain a positive, assuring tone


- **Expected Result**:

```json
[
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 3
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 7
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 9
  }
]
```

###

Example #3: ###

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Hi there, what is the S&P500 trading at right now?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Hello! It's currently priced at just about 6,000$."
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Better than I hoped. And what's the weather looking like today?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "It's 5 degrees Celsius in London today"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Bummer. Does S&P500 still trade at 6,000$ by the way?"
    }
  }
]


- **Guidelines**:
1) condition: the customer asks about the value of a stock., action: provide the price using the 'check_stock_price' tool
2) condition: the weather at a certain location is discussed., action: check the weather at that location using the 'check_weather' tool
3) condition: the customer asked about the weather., action: provide the customre with the temperature and the chances of precipitation


- **Expected Result**:

```json
[
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 9
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 3
  },
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 5
  }
]
```

###

Example #4: ###

- **Interaction Events**:
[
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Hey there, I'd like to book an appointment please"
    }
  },
  {
    "event_kind": "message",
    "event_source": "ai_agent",
    "data": {
      "message": "Hi, sure thing. With whom and at what time?"
    }
  },
  {
    "event_kind": "message",
    "event_source": "user",
    "data": {
      "message": "Great! With John D. please, thank you."
    }
  }
]


- **Guidelines**:
1) condition: the customer wants to book an appointment, action: get the name of the person they want to meet and the time they want to meet them


- **Expected Result**:

```json
[
  {
    "guideline_id": "<example-id-for-few-shots--do-not-use-this-in-output>",
    "applies_score": 8
  }
]
```

###

The following is a list of events describing a back-and-forth
interaction between you and a user: ###
['{"event_kind": "message", "event_source": "user", "data": {"participant": "test_customer", "message": "Hey, can I order a large pepperoni pizza with Sprite?"}}']
###

Here are the most recent staged events for your reference.
They represent interactions with external tools that perform actions or provide information.
Prioritize their data over any other sources and use their details to complete your task: ###
['{"event_kind": "tool", "event_source": "system-provided", "data": {"tool_calls": [{"tool_id": "local:get_available_drinks", "arguments": {}, "result": ["Sprite", "Coca Cola"]}]}}']
###

- Guidelines list: ###
lcQ5PWljqz) Condition: a client asks for a drink. Action: check if the drink is available in stock
###

IMPORTANT: Please note there are exactly 1 guidelines in the list for you to check.

Expected Output
---------------------------
- Specify the applicability of each guideline by filling in the details in the following list as instructed
    ```json
    {
        "checks":
        [{"guideline_id": "lcQ5PWljqz", "applies_score": "<Relevance score of the guideline between 1 and 10. A higher score indicates that the guideline should be active>"}]
    }
    ```